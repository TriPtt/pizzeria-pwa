name: Debug Pipeline

on:
  push:
  pull_request:

jobs:
  debug:
    name: Debug Info
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Setup Node.js 20
        uses: actions/setup-node@v4
        with:
          node-version: '20'
      
      - name: Check secrets (safely)
        run: |
          echo "🔍 Checking secrets availability..."
          if [ -z "$JWT_SECRET" ]; then
            echo "❌ JWT_SECRET is not set"
          else
            echo "✅ JWT_SECRET is available (length: ${#JWT_SECRET})"
          fi
          
          if [ -z "$DATABASE_URL" ]; then
            echo "❌ DATABASE_URL is not set"
          else
            echo "✅ DATABASE_URL is available"
          fi
        env:
          JWT_SECRET: ${{ secrets.JWT_SECRET }}
          DATABASE_URL: ${{ secrets.DATABASE_URL }}
      
      - name: Check project structure
        run: |
          echo "📁 Project structure:"
          ls -la
          echo ""
          echo "📁 Back folder:"
          ls -la back/ || echo "❌ No back folder"
          echo ""
          echo "📁 Front folder:"  
          ls -la front/ || echo "❌ No front folder"
      
      - name: Test backend basic
        run: |
          echo "🔍 Testing backend..."
          if [ -d "back" ] && [ -f "back/package.json" ]; then
            cd back
            echo "📦 Backend package.json found"
            echo "Installing dependencies..."
            npm ci
            echo "✅ Backend dependencies OK"
          else
            echo "❌ Backend setup issue"
          fi
      
      - name: Test frontend basic  
        run: |
          echo "🔍 Testing frontend..."
          if [ -d "front" ] && [ -f "front/package.json" ]; then
            cd front
            echo "📦 Frontend package.json found"
            echo "Installing dependencies..."
            npm ci
            echo "Building..."
            npm run build
            echo "✅ Frontend build OK"
          else
            echo "❌ Frontend setup issue"
          fi
